<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egov.mes.resources.order.dao.ResourcesOrderMapper">

	<!-- 발주 리스트 조회 -->
	<select id="findResourcesOrder" resultType="egov.mes.resources.order.dao.ResourcesOrderVO">
		SELECT O.ORDE_DATE, O.ORDR_NO, O.RSC_CODE, FN_GET_CODE_NAME(O.RSC_CODE) AS RSC_NAME, R.RSC_UNIT, O.RSC_CNT, O.IST_REQ_DATE, FN_GET_CODE_NAME(R.SUPLCOM_CODE) AS SUC_NAME, C.RSC_DEF_CNT, C.RSC_PASS_CNT, R.RSC_PRC  
		FROM RESOURCE_ORDER O
		LEFT JOIN RESOURCES R 
		ON O.RSC_CODE = R.RSC_CODE
		LEFT JOIN RESOURCE_IST_CHECK C
		ON O.ORDR_NO = C.ORDR_NO
		<where>
			<if test="rscName != null and rscName != '' ">
				and FN_GET_CODE_NAME(O.RSC_CODE) = #{rscName} 
			</if>
			<if test="sucName != null and sucName != '' ">
				and FN_GET_CODE_NAME(R.SUPLCOM_CODE) = #{sucName} 
			</if>
			<if test="ordeDate != null">
				<![CDATA[
    			and to_char(O.ORDE_DATE,'yyyyMMdd') >= to_char(#{ordeDate},'yyyyMMdd') AND to_char(O.ORDE_DATE,'yyyyMMdd') <= to_char(#{ordeDate2}, 'yyyyMMdd')
				]]>
			</if>
		</where>
	</select>
	
	<!-- 발주 리스트 조회에서 모달창으로 자재명(RSC로 시작), 자재코드(m_로 시작) 조회 -->
	<select id="searchRec" resultType="egov.mes.resources.order.dao.ResourcesOrderVO" parameterType="egov.mes.resources.order.dao.ResourcesOrderVO">
		SELECT CODE,CODE_NAME, FN_GET_RSC_PRC(CODE) AS RSC_PRC
		FROM COMMON_CODE
		WHERE CODE LIKE '%' || 'RSC' || '%'
	</select>
	
	<select id="searchSuc" resultType="egov.mes.resources.order.dao.ResourcesOrderVO" parameterType="egov.mes.resources.order.dao.ResourcesOrderVO">
		SELECT CODE,CODE_NAME
		FROM COMMON_CODE
		WHERE CODE LIKE '%' || 'm_' || '%'
	</select>
	
	<!-- 자재 발주 페이지 -->
	<insert id="insertResourcesOrder">
		INSERT INTO RESOURCE_ORDER(ORDR_NO, RSC_CODE , RSC_CNT, RSC_TOTAL, ORDE_DATE, IST_REQ_DATE)
                   VALUES(TO_CHAR(SYSDATE, '"PO"YYMMDD""')||LPAD(PONUMBER.nextval,3,'0'),
                          #{rscCode}, 
                          #{rscCnt}, 
                          #{rscTotal},
                          SYSDATE, 
                          #{istReqDate})
	</insert>


</mapper>