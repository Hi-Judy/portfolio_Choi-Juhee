<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egov.mes.resources.order.dao.ResourcesOrderMapper">

	<!-- 발주 리스트 조회 -->
	<!-- 
	<select id="find" resultType="mes.resources.order.dao.ResourcesOrderVO">
		SELECT O.ORDE_DATE, O.ORDR_NO, O.RSC_CODE, FN_GET_CODE_NAME(O.RSC_CODE) AS RSC_NAME, R.RSC_UNIT, O.RSC_CNT, O.IST_REQ_DATE, FN_GET_CODE_NAME(R.SUPLCOM_CODE) AS SUC_NAME, C.RSC_DEF_CNT, C.RSC_PASS_CNT    
		FROM RESOURCE_ORDER O
		LEFT JOIN RESOURCES R 
		ON O.RSC_CODE = R.RSC_CODE
		LEFT JOIN RESOURCE_IST_CHECK C
		ON O.ORDR_NO = C.ORDR_NO
		<where>
			<if test="rscName != null and rscName != '' ">
				and FN_GET_CODE_NAME(O.RSC_CODE) = #{rscName} 
			</if>
			<if test="sucName != null and sucName != '' ">
				and FN_GET_CODE_NAME(R.SUPLCOM_CODE) = #{sucName} 
			</if>
			<if test="ordeDate != null and ordeDate != '' ">
				and ORDE_DATE BETWEEN #{ordeDate} AND #{ordeDate2}
			</if>
		</where>
	</select> -->
	
	<select id="find" resultType="egov.mes.resources.order.dao.ResourcesOrderVO">
		SELECT O.ORDE_DATE, O.ORDR_NO, O.RSC_CODE, FN_GET_CODE_NAME(O.RSC_CODE) AS RSC_NAME, R.RSC_UNIT, O.RSC_CNT, O.IST_REQ_DATE, FN_GET_CODE_NAME(R.SUPLCOM_CODE) AS SUC_NAME, C.RSC_DEF_CNT, C.RSC_PASS_CNT    
		FROM RESOURCE_ORDER O
		LEFT JOIN RESOURCES R 
		ON O.RSC_CODE = R.RSC_CODE
		LEFT JOIN RESOURCE_IST_CHECK C
		ON O.ORDR_NO = C.ORDR_NO
		<where>
			<if test="rscName != null and rscName != '' ">
				and FN_GET_CODE_NAME(O.RSC_CODE) = #{rscName} 
			</if>
			<if test="sucName != null and sucName != '' ">
				and FN_GET_CODE_NAME(R.SUPLCOM_CODE) = #{sucName} 
			</if>
			<if test="ordeDate != null and ordeDate != '' ">
				<![CDATA[
    			ORDE_DATE >= to_char(#{ordeDate},'yy/MM/dd') AND ORDE_DATE <= to_char(#{ordeDate2}, 'yy/MM/dd')
				]]>
			</if>
		</where>
	</select>
	
	<!-- 발주 리스트 조회에서 모달창으로 자재명, 자재코드 조회 -->
	<select id="searchRec" resultType="egov.mes.resources.order.dao.ResourcesOrderVO" parameterType="egov.mes.resources.order.dao.ResourcesOrderVO">
		SELECT CODE,CODE_NAME
		FROM COMMON_CODE
		WHERE CODE LIKE '%' || 'RSC' || '%'
	</select>
	
	<insert id="insertOrder">
		INSERT INTO RESOURCE_ORDER(ORDR_NO, RSC_CODE , RSC_CNT, RSC_TOTAL, ORDE_DATE, IST_REQ_DATE)
                   VALUES(TO_CHAR(SYSDATE, '"PO"YYMMDD""'),
                          #{rscCode}, 
                          #{rscCnt}, 
                          #{rscTotal},
                          SYSDATE, 
                          #{istReqDate});
	</insert>

	

</mapper>